(window.webpackJsonp=window.webpackJsonp||[]).push([[132],{561:function(t,_,v){"use strict";v.r(_);var e=v(57),s=Object(e.a)({},(function(){var t=this,_=t.$createElement,v=t._self._c||_;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"监控工具"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#监控工具"}},[t._v("#")]),t._v(" 监控工具")]),t._v(" "),v("h2",{attrs:{id:"简介"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),v("p",[t._v("Plug Chain Hub 软件可以提供Prometheus监控指标，Prometheus可以收集这些指标。")]),t._v(" "),v("p",[t._v("默认情况下此功能是被禁用的，要启用Prometheus监控指标，请在配置文件（config.toml）中设置"),v("code",[t._v("prometheus = true")]),t._v("。默认情况下，Metrics将在26660端口下的/metrics提供，可以在配置文件中修改服务地址"),v("code",[t._v('prometheus_listen_addr = ":26660"')]),t._v("。")]),t._v(" "),v("h2",{attrs:{id:"监控指标"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#监控指标"}},[t._v("#")]),t._v(" 监控指标")]),t._v(" "),v("p",[t._v("应用层监控参数如下，命名空间："),v("code",[t._v("plugchaind")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("Name")]),t._v(" "),v("th",[t._v("Type")]),t._v(" "),v("th",[t._v("Tags")]),t._v(" "),v("th",[t._v("Description")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("module_stake_bonded_token")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td",[t._v("validator_address")]),t._v(" "),v("td",[t._v("验证人被绑定的token总数")])]),t._v(" "),v("tr",[v("td",[t._v("module_stake_loosen_token")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("未被绑定的token总数")])]),t._v(" "),v("tr",[v("td",[t._v("module_stake_burned_token")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("销毁的token总数")])]),t._v(" "),v("tr",[v("td",[t._v("module_stake_slashed_token")]),t._v(" "),v("td",[t._v("Counter")]),t._v(" "),v("td",[t._v("validator_address")]),t._v(" "),v("td",[t._v("验证人被惩罚的token总数")])]),t._v(" "),v("tr",[v("td",[t._v("module_stake_jailed")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td",[t._v("validator_address")]),t._v(" "),v("td",[t._v("验证人监禁状态，0（未监禁）或1（被监禁）")])]),t._v(" "),v("tr",[v("td",[t._v("module_stake_power")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td",[t._v("validator_address")]),t._v(" "),v("td",[t._v("验证人投票权")])]),t._v(" "),v("tr",[v("td",[t._v("module_upgrade_upgrade")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("是否需要安装新软件，0（否）或1（是）")])]),t._v(" "),v("tr",[v("td",[t._v("module_upgrade_signal")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td",[t._v("validator_address, version")]),t._v(" "),v("td",[t._v("验证人是否运行了新版本软件，0（否）或1（是）")])]),t._v(" "),v("tr",[v("td",[t._v("module_service_active_requests")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("活跃的请求数")])]),t._v(" "),v("tr",[v("td",[t._v("module_gov_parameter")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td",[t._v("parameter_key")]),t._v(" "),v("td",[t._v("治理参数")])]),t._v(" "),v("tr",[v("td",[t._v("module_gov_proposal_status")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td",[t._v("proposal_id")]),t._v(" "),v("td",[t._v("提议状态，0：抵押期 1：投票期 2：通过 3：拒绝 4：其他")])]),t._v(" "),v("tr",[v("td",[t._v("module_gov_vote")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td",[t._v("proposal_id, validator_address")]),t._v(" "),v("td",[t._v("验证人投票结果，0：同意 1：反对 2：强烈反对 3：弃权")])]),t._v(" "),v("tr",[v("td",[t._v("module_distribution_community_tax")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td",[t._v("height")]),t._v(" "),v("td",[t._v("社区基金累计值")])]),t._v(" "),v("tr",[v("td",[t._v("v0_invariant_failure")]),t._v(" "),v("td",[t._v("Counter")]),t._v(" "),v("td",[t._v("error")]),t._v(" "),v("td",[t._v("Invariant检查错误事件")])])])]),t._v(" "),v("p",[t._v("共识层监控参数如下，名字空间："),v("code",[t._v("tendermint")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[v("strong",[t._v("Name")])]),t._v(" "),v("th",[v("strong",[t._v("Type")])]),t._v(" "),v("th",[v("strong",[t._v("Tags")])]),t._v(" "),v("th",[v("strong",[t._v("Description")])])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("consensus_height")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("共识状态机所在高度")])]),t._v(" "),v("tr",[v("td",[t._v("consensus_failure")]),t._v(" "),v("td",[t._v("Counter")]),t._v(" "),v("td",[t._v("height")]),t._v(" "),v("td",[t._v("导致共识状态机终止的错误")])]),t._v(" "),v("tr",[v("td",[t._v("consensus_validators_power")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("验证人的投票权重之和")])]),t._v(" "),v("tr",[v("td",[t._v("consensus_missing_validators")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("块中缺失的precommit数量")])]),t._v(" "),v("tr",[v("td",[t._v("consensus_missing_validators_power")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("块中缺失的precommit对应的验证人所占的投票权重")])]),t._v(" "),v("tr",[v("td",[t._v("consensus_byzantine_validators")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("块中包含的作恶证据对应的验证人数量")])]),t._v(" "),v("tr",[v("td",[t._v("consensus_byzantine_validators_power")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("作恶的验证人的投票权重")])]),t._v(" "),v("tr",[v("td",[t._v("consensus_block_interval_seconds")]),t._v(" "),v("td",[t._v("Histogram")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("从区块被提出到区块执行完毕消耗的时间")])]),t._v(" "),v("tr",[v("td",[t._v("consensus_rounds")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("共识状态机所处的round")])]),t._v(" "),v("tr",[v("td",[t._v("consensus_num_txs")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("区块中包含的交易数量")])]),t._v(" "),v("tr",[v("td",[t._v("consensus_num_txs")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("区块中包含的交易数量")])]),t._v(" "),v("tr",[v("td",[t._v("consensus_block_parts")]),t._v(" "),v("td",[t._v("Counter")]),t._v(" "),v("td",[t._v("peer_id")]),t._v(" "),v("td",[t._v("区块被切分的块数")])]),t._v(" "),v("tr",[v("td",[t._v("consensus_latest_block_height")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("共识状态机上一个高度")])]),t._v(" "),v("tr",[v("td",[t._v("consensus_fast_syncing")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("是否处于fast_sync模式")])]),t._v(" "),v("tr",[v("td",[t._v("consensus_total_txs")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("区块链打包的交易总数")])]),t._v(" "),v("tr",[v("td",[t._v("consensus_block_size_bytes")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("区块大小")])]),t._v(" "),v("tr",[v("td",[t._v("p2p_peers")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("连接的peer的数量")])]),t._v(" "),v("tr",[v("td",[t._v("p2p_peer_receive_bytes_total")]),t._v(" "),v("td",[t._v("Counter")]),t._v(" "),v("td",[t._v("peer_id")]),t._v(" "),v("td",[t._v("从某个peer接受的字节数量")])]),t._v(" "),v("tr",[v("td",[t._v("p2p_peer_send_bytes_total")]),t._v(" "),v("td",[t._v("Counter")]),t._v(" "),v("td",[t._v("peer_id")]),t._v(" "),v("td",[t._v("发给某个peer的字节数量")])]),t._v(" "),v("tr",[v("td",[t._v("p2p_peer_pending_send_bytes")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td",[t._v("peer_id")]),t._v(" "),v("td",[t._v("处于等待发送状态的字节数量")])]),t._v(" "),v("tr",[v("td",[t._v("p2p_num_txs")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td",[t._v("peer_id")]),t._v(" "),v("td",[t._v("某个peer广播过来的交易数量")])]),t._v(" "),v("tr",[v("td",[t._v("mempool_size")]),t._v(" "),v("td",[t._v("Gauge")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("mempool中交易数量")])]),t._v(" "),v("tr",[v("td",[t._v("mempool_tx_size_bytes")]),t._v(" "),v("td",[t._v("Histogram")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("mempool中新增的交易大小")])]),t._v(" "),v("tr",[v("td",[t._v("mempool_failed_txs")]),t._v(" "),v("td",[t._v("Counter")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("mempool收到的无法通过checkTx的交易数量")])]),t._v(" "),v("tr",[v("td",[t._v("mempool_recheck_times")]),t._v(" "),v("td",[t._v("Counter")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("mempool中对多少交易执行过recheck")])]),t._v(" "),v("tr",[v("td",[t._v("state_block_processing_time")]),t._v(" "),v("td",[t._v("Histogram")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("交易执行所消耗的时间，不包含beginBlock和endBlock")])]),t._v(" "),v("tr",[v("td",[t._v("state_recheck_time")]),t._v(" "),v("td",[t._v("Histogram")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("Recheck消耗的时间")])]),t._v(" "),v("tr",[v("td",[t._v("state_app_hash_conflict")]),t._v(" "),v("td",[t._v("Counter")]),t._v(" "),v("td",[t._v("proposer, height")]),t._v(" "),v("td",[t._v("AppHash冲突的错误")])])])]),t._v(" "),v("p",[t._v("Plug Chain Hub metrics也包含tendermint metrics，有关更多信息，请访问"),v("a",{attrs:{href:"https://github.com/tendermint/tendermint/blob/master/docs/nodes/metrics.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("tendermint metrics"),v("OutboundLink")],1),t._v("。")]),t._v(" "),v("h2",{attrs:{id:"启动监控工具"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#启动监控工具"}},[t._v("#")]),t._v(" 启动监控工具")]),t._v(" "),v("p",[t._v("这是使用docker来启动Plug Chain Hub Monitor的示例。")]),t._v(" "),v("h3",{attrs:{id:"编辑prometheus配置文件"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#编辑prometheus配置文件"}},[t._v("#")]),t._v(" 编辑Prometheus配置文件")]),t._v(" "),v("p",[t._v("你可以将示例"),v("a",{attrs:{href:"https://github.com/prometheus/prometheus/blob/master/documentation/examples/prometheus.yml",target:"_blank",rel:"noopener noreferrer"}},[t._v("prometheus.yml"),v("OutboundLink")],1),t._v("下载到"),v("code",[t._v("~/volumes/prometheus/")]),t._v("并在配置文件"),v("code",[t._v("prometheus.yml")]),t._v("中添加以下"),v("code",[t._v("jobs")]),t._v("：")]),t._v(" "),v("div",{staticClass:"language-yaml extra-class"},[v("pre",{pre:!0,attrs:{class:"language-yaml"}},[v("code",[t._v("      "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job_name")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Plug Chain Hub\n          "),v("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_configs")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targets")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),v("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localhost:26660'")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n            "),v("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),v("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" myvalidator\n")])])]),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),v("p",[t._v("targets配置项的值为节点``config.toml"),v("code",[t._v("文件中")]),t._v("prometheus_listen_addr`的值。")])]),t._v(" "),v("h3",{attrs:{id:"启动-prometheus"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#启动-prometheus"}},[t._v("#")]),t._v(" 启动 Prometheus")]),t._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[v("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -d --name"),v("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("prometheus -p "),v("span",{pre:!0,attrs:{class:"token number"}},[t._v("9090")]),t._v(":9090 -v ~/volumes/prometheus:/etc/prometheus prom/prometheus\n")])])]),v("p",[t._v("你应该可以在"),v("a",{attrs:{href:"http://localhost:9090",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://localhost:9090"),v("OutboundLink")],1),t._v("上浏览到prometheus的状态页面。")])])}),[],!1,null,null,null);_.default=s.exports}}]);